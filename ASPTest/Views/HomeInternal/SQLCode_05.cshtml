
@{
    ViewBag.Title = "SQLCode_05";
}
<h2>T-SQL</h2>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="~/Scripts/JQuery/JavaScript.js"></script>

@Html.ActionLink("Return to main...", "IndexSQL", "HomeInternal") - Reorganize all indexes in a database
<br />
<br />
<div id="flip">A JQuery script to collapse/expand the query text. CLICK ME !</div>
<br />
<div id="querypanel" class="code">
    <pre style="font-family:Consolas;font-size:13px;color:black;background:white;"><span style="color:blue;">USE</span>&nbsp;[Cattolica]
<span style="color:blue;">GO</span>
<span style="color:green;">/******&nbsp;Object:&nbsp;&nbsp;UserDefinedFunction&nbsp;[dbo].[fn_GetRemainingHours]&nbsp;&nbsp;&nbsp;&nbsp;Script&nbsp;Date:&nbsp;28/03/2019&nbsp;10:51:05&nbsp;******/</span>
<span style="color:blue;">SET</span>&nbsp;<span style="color:blue;">ANSI_NULLS</span>&nbsp;<span style="color:blue;">ON</span>
<span style="color:blue;">GO</span>
<span style="color:blue;">SET</span>&nbsp;<span style="color:blue;">QUOTED_IDENTIFIER</span>&nbsp;<span style="color:blue;">ON</span>
<span style="color:blue;">GO</span>
 
<span style="color:blue;">ALTER</span>&nbsp;<span style="color:blue;">FUNCTION</span>&nbsp;[dbo]<span style="color:gray;">.</span>[fn_GetRemainingHours]
<span style="color:gray;">(</span>
    <span style="color:green;">--@@IDIncarico&nbsp;&nbsp;INT,</span>
	@@StartDate&nbsp;&nbsp;&nbsp;<span style="color:blue;">DATETIME</span><span style="color:gray;">,</span>
	@@EndDate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">DATETIME</span>
<span style="color:gray;">)</span>
<span style="color:blue;">RETURNS</span>&nbsp;<span style="color:blue;">INT</span>
<span style="color:blue;">AS</span>
<span style="color:blue;">BEGIN</span>
    <span style="color:blue;">DECLARE</span>&nbsp;@@EndDate24Str&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">VARCHAR</span><span style="color:gray;">(</span>8<span style="color:gray;">)</span>
    <span style="color:blue;">DECLARE</span>&nbsp;@@EndDate24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">DATETIME</span>
    <span style="color:blue;">DECLARE</span>&nbsp;@@StartDate24Str&nbsp;&nbsp;<span style="color:blue;">VARCHAR</span><span style="color:gray;">(</span>8<span style="color:gray;">)</span>
    <span style="color:blue;">DECLARE</span>&nbsp;@@StartDate24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">DATETIME</span>
    <span style="color:blue;">DECLARE</span>&nbsp;@@NumberOfHours&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">INT</span>	
    <span style="color:blue;">DECLARE</span>&nbsp;@@ContaGiorniTot&nbsp;&nbsp;<span style="color:blue;">INT</span>
	
    <span style="color:blue;">SET</span>&nbsp;@@EndDate24Str&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:magenta;">CONVERT</span><span style="color:gray;">(</span><span style="color:blue;">VARCHAR</span><span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">,</span>&nbsp;112<span style="color:gray;">)</span>
    <span style="color:blue;">SET</span>&nbsp;@@EndDate24&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:magenta;">CONVERT</span><span style="color:gray;">(</span><span style="color:blue;">DATETIME</span><span style="color:gray;">,</span>&nbsp;@@EndDate24Str<span style="color:gray;">,</span>&nbsp;112<span style="color:gray;">)</span>
    <span style="color:blue;">SET</span>&nbsp;@@StartDate24Str&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:magenta;">CONVERT</span><span style="color:gray;">(</span><span style="color:blue;">VARCHAR</span><span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;112<span style="color:gray;">)</span>
    <span style="color:blue;">SET</span>&nbsp;@@StartDate24&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:magenta;">CONVERT</span><span style="color:gray;">(</span><span style="color:blue;">DATETIME</span><span style="color:gray;">,</span>&nbsp;@@StartDate24Str<span style="color:gray;">,</span>&nbsp;112<span style="color:gray;">)</span>
    <span style="color:blue;">SET</span>&nbsp;@@ContaGiorniTot&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>dd<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>
 
 
    <span style="color:blue;">SELECT</span>&nbsp;@@NumberOfHours&nbsp;<span style="color:gray;">=</span>&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;@@ContaGiorniTot&nbsp;<span style="color:gray;">=</span>&nbsp;0&nbsp;<span style="color:blue;">THEN</span>&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span>24&nbsp;<span style="color:gray;">-</span>&nbsp;<span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;@@StartDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;@@ContaGiorniTot&nbsp;<span style="color:gray;">=</span>&nbsp;1&nbsp;<span style="color:blue;">THEN</span>&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span>24&nbsp;<span style="color:gray;">-</span>&nbsp;<span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;@@StartDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span><span style="color:blue;">&nbsp;</span><span style="color:gray;">(</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span><span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">,</span>&nbsp;@@EndDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;@@ContaGiorniTot&nbsp;<span style="color:gray;">=</span>&nbsp;2&nbsp;<span style="color:blue;">THEN</span>&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span>24&nbsp;<span style="color:gray;">-</span>&nbsp;<span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;@@StartDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span><span style="color:blue;">&nbsp;</span><span style="color:gray;">(</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span><span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">,</span>&nbsp;@@EndDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;@@ContaGiorniTot&nbsp;<span style="color:gray;">=</span>&nbsp;3&nbsp;<span style="color:blue;">THEN</span>&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span>24&nbsp;<span style="color:gray;">-</span>&nbsp;<span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;@@StartDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span><span style="color:blue;">&nbsp;</span><span style="color:gray;">(</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span><span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">,</span>&nbsp;@@EndDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>
<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;2<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;2<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>	
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;@@ContaGiorniTot&nbsp;<span style="color:gray;">=</span>&nbsp;4&nbsp;<span style="color:blue;">THEN</span>&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span>24&nbsp;<span style="color:gray;">-</span>&nbsp;<span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;@@StartDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span><span style="color:blue;">&nbsp;</span><span style="color:gray;">(</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span><span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">,</span>&nbsp;@@EndDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;2<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;2<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>	
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;3<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;3<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>			
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;@@ContaGiorniTot&nbsp;<span style="color:gray;">=</span>&nbsp;5&nbsp;<span style="color:blue;">THEN</span>&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span>24&nbsp;<span style="color:gray;">-</span>&nbsp;<span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;@@StartDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span><span style="color:blue;">&nbsp;</span><span style="color:gray;">(</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span><span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">,</span>&nbsp;@@EndDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;2<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;2<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>	
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;3<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;3<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>
				&nbsp;&nbsp;<span style="color:gray;">+</span>
				&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;4<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;4<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>		
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;@@ContaGiorniTot&nbsp;<span style="color:gray;">=</span>&nbsp;6&nbsp;<span style="color:blue;">THEN</span>&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span>24&nbsp;<span style="color:gray;">-</span>&nbsp;<span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@StartDate<span style="color:gray;">,</span>&nbsp;@@StartDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span><span style="color:blue;">&nbsp;</span><span style="color:gray;">(</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:gray;">-(</span><span style="color:magenta;">DATEDIFF</span><span style="color:gray;">(</span>hh<span style="color:gray;">,</span>&nbsp;@@EndDate<span style="color:gray;">,</span>&nbsp;@@EndDate24&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;1<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;2<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;2<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>	
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">+</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;3<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;3<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>
				&nbsp;&nbsp;<span style="color:gray;">+</span>
				&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;4<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;4<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>	
				&nbsp;&nbsp;<span style="color:gray;">+</span>
				&nbsp;<span style="color:blue;">CASE</span>&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;5<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Saturday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0
					&nbsp;&nbsp;<span style="color:blue;">WHEN</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">+</span>&nbsp;5<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">=</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span>&nbsp;<span style="color:blue;">THEN</span>&nbsp;0&nbsp;
					&nbsp;&nbsp;<span style="color:blue;">ELSE</span>&nbsp;24&nbsp;<span style="color:blue;">END</span>							&nbsp;&nbsp;										&nbsp;&nbsp;									&nbsp;&nbsp;			&nbsp;&nbsp;								&nbsp;&nbsp;				&nbsp;&nbsp;					&nbsp;&nbsp;
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">END</span>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span style="color:green;">--&nbsp;Tolgo&nbsp;24&nbsp;ore&nbsp;per&nbsp;ciascuna&nbsp;giornata&nbsp;festiva&nbsp;in&nbsp;tabella</span>
    <span style="color:green;">--&nbsp;***&nbsp;RICORDARSI&nbsp;DI&nbsp;&nbsp;AGGIORNARE&nbsp;TABELLA&nbsp;FESTIVI&nbsp;REGOLARMENTE&nbsp;***&nbsp;</span>
    <span style="color:blue;">SET</span>&nbsp;@@NumberOfHours&nbsp;<span style="color:gray;">=</span>&nbsp;@@NumberOfHours&nbsp;<span style="color:gray;">-(</span>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">SELECT</span>&nbsp;<span style="color:magenta;">COUNT</span><span style="color:gray;">(</span>ID<span style="color:gray;">)</span>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">FROM</span>&nbsp;&nbsp;&nbsp;Festivita
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">WHERE</span>&nbsp;&nbsp;Festivo&nbsp;<span style="color:gray;">BETWEEN</span>&nbsp;@@StartDate&nbsp;<span style="color:gray;">AND</span>&nbsp;@@EndDate
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">AND</span>&nbsp;<span style="color:magenta;">DATENAME</span><span style="color:gray;">(</span>dw<span style="color:gray;">,</span>&nbsp;Festivo<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">NOT</span>&nbsp;<span style="color:gray;">IN</span><span style="color:blue;">&nbsp;</span><span style="color:gray;">(</span><span style="color:red;">&#39;Saturday&#39;</span><span style="color:gray;">,</span>&nbsp;<span style="color:red;">&#39;Sunday&#39;</span><span style="color:gray;">)</span>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:gray;">)</span>&nbsp;<span style="color:gray;">*</span>&nbsp;24&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <span style="color:blue;">RETURN</span>&nbsp;@@NumberOfHours
<span style="color:blue;">END</span></pre>

</div>
